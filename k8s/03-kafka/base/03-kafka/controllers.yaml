apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaNodePool
metadata:
  name: controllers
  namespace: kafka
  labels: { strimzi.io/cluster: demo-kafka }
spec:
  replicas: 3
  roles: ["controller"]
  resources:
    requests: { cpu: "1", memory: "2Gi" }
    limits:   { cpu: "1", memory: "2Gi" }        # Guaranteed QoS
  storage:
    type: persistent-claim
    size: 20Gi
    class: pd-ssd
    deleteClaim: false
  template:
    pod:
      tolerations:
        - key: dedicated
          operator: Equal
          value: kafka
          effect: NoSchedule
      # Topology spread constraints ensure controllers are distributed across different nodes
      # maxSkew=1 means at most 1 controller difference between nodes for fault tolerance
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: DoNotSchedule
          labelSelector:
            matchLabels:
              strimzi.io/pool-name: controllers
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: role
                  operator: In
                  values: ["kafka"]