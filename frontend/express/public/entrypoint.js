// Countly Dashboard Entrypoint
// This file serves as the main entry point for the Vite bundler

// =============================================================================
// CSS/SCSS IMPORTS (from Gruntfile.js cssmin and sass tasks)
// =============================================================================

// Main stylesheets
import './stylesheets/main.css';
import './stylesheets/vue/clyvue.scss';
import './stylesheets/leaflet/leaflet.css';
import './javascripts/dom/gridstack/gridstack.css';
import './stylesheets/bulma/bulma-custom.css';
import './stylesheets/styles/manifest.scss';

// Plugin stylesheets
// import.meta.glob('../../../plugins/*/frontend/public/stylesheets/**/*.scss', { eager: true });
import.meta.glob('../../../plugins/*/frontend/public/stylesheets/**/*.css');

import "./imports.js";

import { setupCountlyWebSDK } from './javascripts/web-sdk-setup.js';

// =============================================================================
// LEGACY SCRIPT IMPORTS
// =============================================================================

// Import all legacy scripts concatenated into a single shared scope
// This virtual module is generated by the legacyConcatPlugin in vite.config.js
// All legacy scripts share the same scope and can access each other's variables
import 'virtual:legacy-concat';

// =============================================================================
// CORE PLUGIN IMPORTS
// TO-DO:
// These static imports will be replaced with dynamic imports (lazy-loading)
// once vue-router is integrated, enabling route-based code-splitting.
// =============================================================================
import './core/session-durations/index.js';
import './core/session-frequency/index.js';
import './core/session-overview/index.js';
import './core/logs/index.js';
import './core/app-resolution/index.js';
import './core/app-version/index.js';
import './core/platform/index.js';
import './core/version-history/index.js';
import './core/jobs/index.js';
import './core/token-manager/index.js';
import './core/home/index.js';
import './core/carrier/index.js';
import './core/health-manager/index.js';
import './core/date-presets/index.js';
import './core/user-activity/index.js';
import './core/user-analytics-overview/index.js';
import './core/geo-countries/index.js';
import './core/report-manager/index.js';
import './core/onboarding/index.js';

// Report manager component imports (globally registered - used by sidebar, drill, funnels, etc.)
import ClyReportManagerDialog from './core/report-manager/components/ClyReportManagerDialog.vue';

// Component imports
import ClyStatusBadge from './javascripts/components/cly-status-badge.vue';
import ClyTabs from './javascripts/components/nav/cly-tabs.vue';
import ClyDynamicTabs from './javascripts/components/nav/cly-dynamic-tabs.vue';

// Form component imports
import ClyForm from './javascripts/components/form/cly-form.vue';
import ClyFormStep from './javascripts/components/form/cly-form-step.vue';
import ClyFormField from './javascripts/components/form/cly-form-field.vue';
import ClyFormFieldGroup from './javascripts/components/form/cly-form-field-group.vue';
import ClyInlineFormField from './javascripts/components/form/cly-inline-form-field.vue';
import ClyFormFieldChecklistbox from './javascripts/components/form/cly-form-field-checklistbox.vue';

// Drawer component imports
import ClyDrawer from './javascripts/components/drawer/cly-drawer.vue';

// Layout component imports
import ClyGuide from './javascripts/components/layout/cly-guide.vue';
import ClyHeader from './javascripts/components/layout/cly-header.vue';
import ClyMain from './javascripts/components/layout/cly-main.vue';
import ClySection from './javascripts/components/layout/cly-section.vue';
import ClySubSection from './javascripts/components/layout/cly-sub-section.vue';

// Content component imports
import ClyContentLayout from './javascripts/components/content/cly-content-layout.vue';
import ClyContentHeader from './javascripts/components/content/cly-content-header.vue';
import ClyContentBody from './javascripts/components/content/cly-content-body.vue';
import ClyContentBuilderSidebarStep from './javascripts/components/content/cly-content-builder-sidebar-step.vue';
import ClyContentBuilderSidebarInput from './javascripts/components/content/cly-content-builder-sidebar-input.vue';
import ClyContentBlockListInput from './javascripts/components/content/cly-content-block-list-input.vue';
import ClyOptionSwapper from './javascripts/components/content/cly-option-swapper.vue';
import ClyDeviceSelector from './javascripts/components/content/cly-device-selector.vue';

// Dialog component imports
import ClyDialog from './javascripts/components/dialog/cly-dialog.vue';
import ClyConfirmDialog from './javascripts/components/dialog/cly-confirm-dialog.vue';
import ClyMessageDialog from './javascripts/components/dialog/cly-message-dialog.vue';
import ClyFormDialog from './javascripts/components/dialog/cly-form-dialog.vue';

// Dropdown component imports
import ClyInputDropdownTrigger from './javascripts/components/dropdown/input-dropdown-trigger.vue';
import ClyDropdown from './javascripts/components/dropdown/dropdown.vue';
import ClyFieldsSelect from './javascripts/components/dropdown/fields-select.vue';
import ClyMultiSelect from './javascripts/components/dropdown/multi-select.vue';
import ClyMoreOptions from './javascripts/components/dropdown/more-options.vue';

// Progress component imports
import ClyProgressDonut from './javascripts/components/progress/progress-donut.vue';
import ClyProgressBar from './javascripts/components/progress/progress-bar.vue';

// Input component imports
import ClyColorpicker from './javascripts/components/input/colorpicker.vue';
import ClyListbox from './javascripts/components/input/listbox.vue';
import ClyChecklistbox from './javascripts/components/input/checklistbox.vue';
import ClySelectX from './javascripts/components/input/select-x.vue';
import ClyCheck from './javascripts/components/input/check.vue';
import ClyRadioBlock from './javascripts/components/input/radio-block.vue';
import ClyDynamicTextarea from './javascripts/components/input/dynamic-textarea.vue';
import ClySelectEmail from './javascripts/components/input/select-email.vue';
import ClySortableItems from './javascripts/components/input/sortable-items.vue';

// Date component imports
import ClyDatePicker from './javascripts/components/date/date-picker.vue';
import ClyGlobalDatePicker from './javascripts/components/date/global-date-picker.vue';
import ClyTimePicker from './javascripts/components/date/time-picker.vue';
import { getPeriodLabel } from './javascripts/components/date/mixins.js';

// Helper component imports
import ClyBackLink from './javascripts/components/helpers/cly-back-link.vue';
import ClyInPageNotification from './javascripts/components/helpers/cly-in-page-notification.vue';
import ClyEmptyHome from './javascripts/components/helpers/cly-empty-home.vue';
import ClyHomeWidgetHeader from './core/home/components/HomeWidgetTitle.vue';
import ClyStatusTag from './javascripts/components/helpers/cly-status-tag.vue';
import ClyDiffHelper from './javascripts/components/helpers/cly-diff-helper.vue';
import ClyMetricCards from './javascripts/components/helpers/cly-metric-cards.vue';
import ClyMetricCard from './javascripts/components/helpers/cly-metric-card.vue';
import ClyMetricBreakdown from './javascripts/components/helpers/cly-metric-breakdown.vue';
import ClyTooltipIcon from './javascripts/components/helpers/cly-tooltip-icon.vue';
import ClyRemover from './javascripts/components/helpers/cly-remover.vue';
import ClyPopover from './javascripts/components/helpers/cly-popover.vue';
import ClyValue from './javascripts/components/helpers/cly-value.vue';
import ClyAppSelect from './javascripts/components/helpers/cly-app-select.vue';
import ClyEventSelect from './javascripts/components/helpers/cly-event-select.vue';
import ClyPaginate from './javascripts/components/helpers/cly-paginate.vue';
import ClyColorTag from './javascripts/components/helpers/cly-color-tag.vue';
import ClyJsonEditor from './javascripts/components/helpers/cly-json-editor.vue';
import ClyNotification from './javascripts/components/helpers/cly-notification.vue';
import ClyEmptyView from './javascripts/components/helpers/cly-empty-view.vue';
import ClyEmptyChart from './javascripts/components/helpers/cly-empty-chart.vue';
import ClyEmptyDatatable from './javascripts/components/helpers/cly-empty-datatable.vue';
import ClyBlank from './javascripts/components/helpers/cly-blank.vue';
import ClyBreadcrumbs from './javascripts/components/helpers/cly-breadcrumbs.vue';
import ClyMultiplex from './javascripts/components/helpers/cly-multiplex.vue';
import ClyListDrawer from './javascripts/components/helpers/cly-list-drawer.vue';
import ClyAutoRefreshToggle from './javascripts/components/helpers/cly-auto-refresh-toggle.vue';
import ClyDatabaseEngineDebugPanel from './javascripts/components/helpers/cly-database-engine-debug-panel.vue';
import ClyContent from './javascripts/components/helpers/cly-content.vue';

// Datatable component imports
import ClyDatatableN from './javascripts/components/datatable/cly-datatable-n.vue';

// Echart component imports
import {
    ClyChartZoom,
    ClyChartToggle,
    ClyPrimaryLegend,
    ClySecondaryLegend,
    ClyCustomLegend,
    ClyChartHeader,
    ClyAnnotationManagement,
    ClyChartGeneric,
    ClyChartFlow,
    ClyChartLine,
    ClyChartTime,
    ClyChartBar,
    ClyChartPie,
    ClyMapPicker,
    ClyWorldmap,
    ExternalZoomMixin
} from './javascripts/components/echart/index.js';

// Register components globally
window.Vue.component('cly-status-badge', ClyStatusBadge);
window.Vue.component('cly-tabs', ClyTabs);
window.Vue.component('cly-dynamic-tabs', ClyDynamicTabs);

// Register form components globally
window.Vue.component('cly-form', ClyForm);
window.Vue.component('cly-form-step', ClyFormStep);
window.Vue.component('cly-form-field', ClyFormField);
window.Vue.component('cly-form-field-group', ClyFormFieldGroup);
window.Vue.component('cly-inline-form-field', ClyInlineFormField);
window.Vue.component('cly-form-field-checklistbox', ClyFormFieldChecklistbox);

// Register drawer components globally
window.Vue.component('cly-drawer', ClyDrawer);

// Register layout components globally
window.Vue.component('cly-guide', ClyGuide);
window.Vue.component('cly-header', ClyHeader);
window.Vue.component('cly-main', ClyMain);
window.Vue.component('cly-section', ClySection);
window.Vue.component('cly-sub-section', ClySubSection);

// Register content components globally
window.Vue.component('cly-content-layout', ClyContentLayout);
window.Vue.component('cly-content-header', ClyContentHeader);
window.Vue.component('cly-content-body', ClyContentBody);
window.Vue.component('cly-content-builder-sidebar-step', ClyContentBuilderSidebarStep);
window.Vue.component('cly-content-builder-sidebar-input', ClyContentBuilderSidebarInput);
window.Vue.component('cly-content-block-list-input', ClyContentBlockListInput);
window.Vue.component('cly-option-swapper', ClyOptionSwapper);
window.Vue.component('cly-device-selector', ClyDeviceSelector);

// Register dialog components globally
window.Vue.component('cly-dialog', ClyDialog);
window.Vue.component('cly-confirm-dialog', ClyConfirmDialog);
window.Vue.component('cly-message-dialog', ClyMessageDialog);
window.Vue.component('cly-form-dialog', ClyFormDialog);

// Register dropdown components globally
window.Vue.component('cly-input-dropdown-trigger', ClyInputDropdownTrigger);
window.Vue.component('cly-dropdown', ClyDropdown);
window.Vue.component('cly-fields-select', ClyFieldsSelect);
window.Vue.component('cly-multi-select', ClyMultiSelect);
window.Vue.component('cly-more-options', ClyMoreOptions);

// Register progress components globally
window.Vue.component('cly-progress-donut', ClyProgressDonut);
window.Vue.component('cly-progress-bar', ClyProgressBar);

// Register input components globally
window.Vue.component('cly-colorpicker', ClyColorpicker);
window.Vue.component('cly-listbox', ClyListbox);
window.Vue.component('cly-checklistbox', ClyChecklistbox);
window.Vue.component('cly-select-x', ClySelectX);
window.Vue.component('cly-check', ClyCheck);
window.Vue.component('cly-radio-block', ClyRadioBlock);
window.Vue.component('cly-dynamic-textarea', ClyDynamicTextarea);
window.Vue.component('cly-select-email', ClySelectEmail);
window.Vue.component('cly-sortable-items', ClySortableItems);

// Register date components globally
window.Vue.component('cly-date-picker', ClyDatePicker);
window.Vue.component('cly-date-picker-g', ClyGlobalDatePicker);
window.Vue.component('cly-global-date-selector-w', ClyGlobalDatePicker); // deprecated alias?
window.Vue.component('cly-time-picker', ClyTimePicker);

window.countlyVue.getPeriodLabel = getPeriodLabel; // remove this after updating the date-preset plugin

// Register helper components globally
window.Vue.component('cly-back-link', ClyBackLink);
window.Vue.component('cly-in-page-notification', ClyInPageNotification);
window.Vue.component('cly-empty-home', ClyEmptyHome);
window.Vue.component('clyd-home-widget-header', ClyHomeWidgetHeader);
window.Vue.component('cly-status-tag', ClyStatusTag);
window.Vue.component('cly-diff-helper', ClyDiffHelper);
window.Vue.component('cly-metric-cards', ClyMetricCards);
window.Vue.component('cly-metric-card', ClyMetricCard);
window.Vue.component('cly-metric-breakdown', ClyMetricBreakdown);
window.Vue.component('cly-tooltip-icon', ClyTooltipIcon);
window.Vue.component('cly-remover', ClyRemover);
window.Vue.component('cly-popover', ClyPopover);
window.Vue.component('cly-value', ClyValue);
window.Vue.component('cly-app-select', ClyAppSelect);
window.Vue.component('cly-event-select', ClyEventSelect);
window.Vue.component('cly-paginate', ClyPaginate);
window.Vue.component('cly-color-tag', ClyColorTag);
window.Vue.component('cly-json-editor', ClyJsonEditor);
window.Vue.component('cly-notification', ClyNotification);
window.Vue.component('cly-empty-view', ClyEmptyView);
window.Vue.component('cly-empty-chart', ClyEmptyChart);
window.Vue.component('cly-empty-datatable', ClyEmptyDatatable);
window.Vue.component('cly-blank', ClyBlank);
window.Vue.component('cly-breadcrumbs', ClyBreadcrumbs);
window.Vue.component('cly-multiplex', ClyMultiplex);
window.Vue.component('cly-list-drawer', ClyListDrawer);
window.Vue.component('cly-auto-refresh-toggle', ClyAutoRefreshToggle);
window.Vue.component('cly-database-engine-debug-panel', ClyDatabaseEngineDebugPanel);
window.Vue.component('cly-content', ClyContent);

// Register datatable components
window.Vue.component('cly-datatable-n', ClyDatatableN);

// Register echart components
window.Vue.component('cly-chart-zoom', ClyChartZoom);
window.Vue.component('cly-chart-toggle', ClyChartToggle); // only in echart components
window.Vue.component('cly-primary-legend', ClyPrimaryLegend); // only in echart components
window.Vue.component('cly-secondary-legend', ClySecondaryLegend); // only in echart components
window.Vue.component('cly-custom-legend', ClyCustomLegend); // only in echart components
window.Vue.component('cly-chart-header', ClyChartHeader); // only in echart components
window.Vue.component('cly-annotation-management', ClyAnnotationManagement); // only in echart components
window.Vue.component('cly-chart-generic', ClyChartGeneric);
window.Vue.component('cly-chart-flow', ClyChartFlow);
window.Vue.component('cly-chart-line', ClyChartLine);
window.Vue.component('cly-chart-time', ClyChartTime);
window.Vue.component('cly-chart-bar', ClyChartBar);
window.Vue.component('cly-chart-pie', ClyChartPie);
window.Vue.component('cly-map-picker', ClyMapPicker);
window.Vue.component('cly-worldmap', ClyWorldmap);

// Report manager dialog (globally registered - used by sidebar, drill, funnels, etc.)
window.Vue.component('cly-report-manager-dialog', ClyReportManagerDialog);

// Export zoom mixin for backward compatibility
window.countlyVue.mixins.zoom = ExternalZoomMixin;

// =============================================================================
// ES MODULE PLUGIN IMPORTS
// =============================================================================
import.meta.glob('../../../plugins/*/frontend/public/index.js');

// =============================================================================
// NEW ES MODULE CODE GOES BELOW
// =============================================================================
//
// From here onwards, you can use standard ES module import/export syntax.
// All legacy globals (like $, _, Backbone, Vue, countlyGlobal, countlyCommon, etc.)
// are available on the window object after the legacy scripts execution.
//
// Example usage:
//
// import { MyNewModule } from './javascripts/modules/my-new-module.js';
// import { SomeHelper } from './javascripts/helpers/some-helper.js';
//
// The legacy code can still be accessed via window:
// const $ = window.jQuery;
// const Vue = window.Vue;
// const countlyCommon = window.countlyCommon;
//
// =============================================================================

// Start Backbone history for routing
import Backbone from './javascripts/utils/backbone-min.js';
Backbone.history.start();

// Setup Countly Web SDK
setupCountlyWebSDK();
