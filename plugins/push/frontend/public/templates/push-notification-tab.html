<script type="text/x-template" id="push-notification-tab">
    <div v-bind:class="[componentId]">
        <cly-main>
            <cly-section>
                <cly-metric-cards>
                    <cly-metric-card :number="totalAppUsers">
                        {{i18n('push-notification.total-app-users')}}
                    </cly-metric-card>
                    <cly-metric-card :number="enabledUsers">
                        {{i18n('push-notification.enabled-users')}}                     
                    </cly-metric-card>
                    <cly-metric-card :is-percentage="true" :number="enabledUsersPercentage">
                        {{i18n('push-notification.enabled-users-percentage')}}
                        <cly-tooltip-icon :tooltip="i18n('push-notification.enabled-users-percentage-description')" icon="ion ion-help-circled" class="bu-ml-2"> </cly-tooltip-icon>                     
                    </cly-metric-card>
                </cly-metric-cards>
            </cly-section>
            <div>
                <div class="bu-level-left" style="margin-bottom:32px">
                    <div class="bu-level-item">
                        <div class="cly-vue-platform-filter-label"> 
                            {{platformFilterLabels[selectedPushNotificationType]}} 
                        </div>
                    </div>
                    <div class="bu-level-item">
                        <el-select v-model="selectedPlatformFilter" :arrow="false" :adaptiveLength="true">
                            <el-option v-for="item in platformFilters" :key="item.value" :value="item.value" :label="item.label">
                            </el-option>
                        </el-select>
                    </div>
                </div>
            </div>
            <cly-section>
                <cly-chart-time :bucket="selectedPeriodFilter" :option="pushNotificationOptions" :height="400" v-loading="isLoading" :legend="legend" class="cly-vue-push-notification-chart">
                    <template v-slot:chart-left="scope">
                        <span class="cly-vue-push-notification-chart__left-text bu-mr-2">{{i18n('push-notification.time-period')}}</span>
                        <div style="width:100px;">
                            <el-select v-if="selectedPushNotificationType === TypeEnum.ONE_TIME" v-model="selectedOneTimePeriodFilter">
                                <el-option :key="item.value" :value="item.value" :label="item.label"
                                    v-for="item in oneTimePeriodFilters"></el-option>
                            </el-select>
                            <el-select v-else-if="selectedPushNotificationType === TypeEnum.AUTOMATIC" v-model="selectedAutomaticPeriodFilter">
                                <el-option :key="item.value" :value="item.value" :label="item.label"
                                    v-for="item in automaticPeriodFilters"></el-option>
                            </el-select>
                            <el-select v-else v-model="selectedTransactionalPeriodFilter">
                                <el-option :key="item.value" :value="item.value" :label="item.label"
                                    v-for="item in transactionalPeriodFilters"></el-option>
                            </el-select>
                        </div>
                    </template>
                </cly-chart-time>
            </cly-section>
            <cly-section>
                <cly-datatable-n  :rows="pushNotificationRows" :available-dynamic-cols="optionalTableColumns" :resizable="true" v-loading="isLoading">
                    <template v-slot:header-left>
                        <el-select v-model="selectedStatusFilter">
                            <el-option
                                :key="item.value"
                                :value="item.value"
                                :label="item.label"
                                v-for="item in statusFilters[selectedPushNotificationType]">
                            </el-option>
                        </el-select>
                    </template>
                    <template v-slot="scope">
                        <el-table-column fixed width="400" type="clickable" sortable="custom" prop="name" :label="i18n('push-notification.table-notification-name')" class="cly-vue-push-notification-table-column">
                            <template slot-scope="scope">
                                <div class="bu-is-flex bu-is-flex-direction-column">
                                    <span class="cly-vue-push-notification-table-column__first-line" @click="onRowClick(scope.row)">{{scope.row.name}}</span>
                                    <span class="cly-vue-push-notification-table-column__second-line">
                                        <span> {{getPreviewPlatforms(scope.row.platforms)}} </span>
                                        <span class="blinker cly-vue-push-notification-table-column__separator-blinker"></span>
                                        <span> {{i18n('push-notification.created-by')}} {{scope.row.createdBy}} </span>
                                    </span>
                                </div>
                            </template>
                        </el-table-column>
                        <template v-for="(col,idx) in scope.dynamicCols">
                            <el-table-column 
                                width="360"
                                v-if="col.value === 'content'"  
                                :key="idx" 
                                sortable="custom" 
                                :label="col.label">
                                <template v-slot="rowScope">
                                    {{rowScope.row.content}}
                                </template>
                            </el-table-column>
                            <el-table-column 
                                width="200"
                                v-if="col.value === 'createdBy'"  
                                :key="idx" 
                                sortable="custom" 
                                :label="col.label">
                                <template v-slot="rowScope">
                                    {{rowScope.row.createdBy}}
                                </template>
                            </el-table-column>
                        </template>
                        <el-table-column width="220" sortable="custom" prop="status" :label="i18n('push-notification.table-status')">
                            <template slot-scope="scope">
                                <span class="blinker-wrapper" v-bind:style="{backgroundColor:getStatusBackgroundColor(scope.row.status.value).concat(DEFAULT_ALPHA_COLOR_VALUE_HEX)}"> 
                                    <span class="blinker" v-bind:style="{backgroundColor:getStatusBackgroundColor(scope.row.status.value)}">  </span>{{scope.row.status.label}}
                                </span>
                            </template>
                        </el-table-column>
                        <el-table-column width="220" sortable="custom" prop="createdDateTime" :label="i18n('push-notification.table-created')"  class="cly-vue-push-notification-table-column">
                            <template slot-scope="scope">
                                <div class="bu-is-flex bu-is-flex-direction-column">
                                    <span class="cly-vue-push-notification-table-column__first-line">{{scope.row.createdDateTime.date}}</span>
                                    <span class="cly-vue-push-notification-table-column__second-line">{{scope.row.createdDateTime.time}}</span>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column  width="280" sortable="custom" prop="sentDateTime" :label="i18n('push-notification.table-date-sent')" class="cly-vue-push-notification-table-column">
                            <template slot-scope="scope">
                                <div class="bu-is-flex bu-is-flex-direction-column">
                                    <span class="cly-vue-push-notification-table-column__first-line">{{scope.row.sentDateTime.date}}</span>
                                    <span class="cly-vue-push-notification-table-column__second-line">{{scope.row.sentDateTime.time}}</span>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column sortable="custom" prop="sent" :label="i18n('push-notification.table-sent')" class="cly-vue-push-notification-table-column">
                            <template slot-scope="scope">
                                <span class="cly-vue-push-notification-table-column__numbers-only"> {{scope.row.sent}} </span>
                            </template>
                        </el-table-column>
                        <el-table-column sortable="custom" prop="actioned" :label="i18n('push-notification.table-actioned')" class="cly-vue-push-notification-table-column">
                            <template slot-scope="scope">
                                <div class="bu-level">
                                    <div class="bu-level-left cly-vue-push-notification-table-column__numbers-only">
                                        <span class="bu-mr-1">{{formatNumber(scope.row.actioned)}}</span>
                                        <span class="bu-mr-1">|</span>
                                        <span>{{formatPercentage(scope.row.actioned/totalAppUsers)}} %</span>
                                    </div>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column type="options">
                            <template slot-scope="scope">
                                <cly-more-options v-if="scope.row.hover" size="small" @command="handleUserEvents($event, scope.row._id )">
                                    <el-dropdown-item v-if="shouldShowDuplicateUserEvent(scope.row.status.value)" :command="UserEventEnum.DUPLICATE">{{i18n('push-notification.duplicate')}}</el-dropdown-item>
                                    <el-dropdown-item v-if="shouldShowDeleteUserEvent(scope.row.status.value)"  :command="UserEventEnum.DELETE">{{i18n('push-notification.delete')}}</el-dropdown-item>
                                    <el-dropdown-item v-if="shouldShowResendUserEvent(scope.row.status.value)" :command="UserEventEnum.RESEND">{{i18n('push-notification.resend')}}</el-dropdown-item>
                                    <el-dropdown-item v-if="shouldShowApproveUserEvent(scope.row.status.value)"  :command="UserEventEnum.APPROVE">{{i18n('push-notification.approve')}}</el-dropdown-item>
                                    <el-dropdown-item v-if="shouldShowRejectUserEvent(scope.row.status.value)" :command="UserEventEnum.REJECT">{{i18n('push-notification.reject')}}</el-dropdown-item>
                                </cly-more-options>
                            </template>
                        </el-table-column>
                    </template>
                </cly-datatable-n>
            </cly-section>
        </cly-main>
    </div>
</script>