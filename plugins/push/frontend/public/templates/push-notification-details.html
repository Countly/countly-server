<script type="text/x-template" id="push-notification-details">
    <div v-bind:class="[componentId]">
        <cly-header class="cly-vue-push-notification-details-header">
            <template v-slot:header-left>
                <h2> {{pushNotification.name }} </h2>
            </template>
            <template v-slot:header-top>
                <cly-back-link link="/messaging" :title="i18n('push-notification-details.back-to')"></cly-back-link>
            </template>
            <template v-slot:header-right>
                <template v-if="pushNotification.status === StatusEnum.PENDING_APPROVAL && hasApproverPermission">
                    <el-button @click="onReject(pushNotification._id)" class="bu-mr-2"> <i class="ion-close-circled" ></i> Reject </el-button>
                    <el-button @click="onApprove(pushNotification._id)" class="bu-mr-2 bu-ml-0"> <i class="ion-checkmark-circled" ></i> Approve </el-button>
                </template>
                <cly-more-options size="small" @command="handleUserCommands($event, pushNotification.id)">
                    <el-dropdown-item v-if="shouldShowDuplicateUserCommand(pushNotification.status)" :command="UserCommandEnum.DUPLICATE">{{i18n('push-notification.duplicate')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowDeleteUserCommand(pushNotification.status)"  :command="UserCommandEnum.DELETE">{{i18n('push-notification.delete')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowResendUserCommand(pushNotification.status)" :command="UserCommandEnum.RESEND">{{i18n('push-notification.resend')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowApproveUserCommand(pushNotification.status)"  :command="UserCommandEnum.APPROVE">{{i18n('push-notification.approve')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowRejectUserCommand(pushNotification.status)" :command="UserCommandEnum.REJECT">{{i18n('push-notification.reject')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowEditDraftUserCommand(pushNotification.status)" :command="UserCommandEnum.EDIT_DRAFT">{{i18n('push-notification.edit-draft')}}</el-dropdown-item>
                    <el-dropdown-item v-if="shouldShowEditUserCommand(pushNotification.status)" :command="UserCommandEnum.EDIT">{{i18n('push-notification.edit')}}</el-dropdown-item>
                </cly-more-options>
            </template>
            <template v-slot:header-bottom>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <cly-status-tag :text="pushNotification.status" :color="getStatusBackgroundColor(pushNotification.status)"> </cly-status-tag>
                </div>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <div class="ion ion-ios-time-outline cly-vue-push-notification-details-sub-header-icon"></div>
                    <span class="cly-vue-push-notification-details-sub-header-title"> {{i18n('push-notification-details.created')}} {{pushNotification.createdDateTime && formatDateAgoText(pushNotification.createdDateTime.date)}} by  {{pushNotification.createdBy}}  </span>
                </div>
                <div class="bu-level-item cly-vue-push-notification-details-sub-header">
                    <div class="ion ion-pricetag cly-vue-push-notification-details-sub-header-icon"></div>
                    <span class="cly-vue-push-notification-details-sub-header-title"> {{i18n('push-notification-details.message-id')}} {{pushNotification.id}} </span>
                </div>
            </template>
        </cly-header>
        <cly-main>
            <div>
                <div class="bu-level-left" style="margin-bottom:32px">
                    <div class="bu-level-item">
                        <div class="cly-vue-platform-filter-label"> 
                            {{i18n('push-notification-details.results-for')}}
                        </div>
                    </div>
                    <div class="bu-level-item">
                        <el-select v-model="selectedPlatformFilter">
                            <el-option :key="item.value" :value="item.value" :label="item.label"
                                v-for="item in platformFilters"
                            >
                            </el-option>
                        </el-select>
                    </div>
                    <div class="bu-level-item">
                        <div class="cly-vue-platform-filter-label"> 
                            {{i18n('push-notification-details.and-label')}}
                        </div>
                    </div>
                    <div class="bu-level-item">
                        <el-select v-model="selectedLocalization">
                            <el-option v-for="item in localizations" :key="item.value" :value="item.value" :label="item.label">
                            </el-option>
                        </el-select>
                    </div>
                </div>
            </div>
            <cly-section>
                <div class="bu-is-flex cly-vue-push-notification-details-chart-bars">
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right">
                        <cly-chart-bar :option="pushNotificationChartBars.targetedUsers" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> Users Targeted  <cly-tooltip-icon :tooltip="i18n('push-notification.description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{findTargetedUsers()}} % </div>
                                <div class="text-medium"> {{totalAppUsers}} users  </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right"> 
                        <cly-chart-bar :option="pushNotificationChartBars.sentPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> Sent Notifications  <cly-tooltip-icon :tooltip="i18n('push-notification.description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{findSentPushNotifications()}} % </div>
                                <div class="text-medium"> {{totalAppUsers}} users  </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item cly-vue-push-notification-details-chart-bars__border-right"> 
                        <cly-chart-bar :option="pushNotificationChartBars.clickedPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend cly-vue-push-notification-details-chart-bars__border-right"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> Clicked Notifications <cly-tooltip-icon :tooltip="i18n('push-notification.description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{findClickedPushNotifications()}} % </div>
                                <div class="text-medium"> {{totalAppUsers}} users </div>
                            </div>
                        </div>
                    </div>
                    <div class="bu-is-flex bu-is-flex-direction-column cly-vue-push-notification-details-chart-bars__item"> 
                        <cly-chart-bar :option="pushNotificationChartBars.failedPushNotifications" :loading="isLoading" :legend="chartBarLegend" :showZoom=false :showToggle=false :showDownload=false ></cly-chart-bar>
                        <div class="cly-vue-push-notification-details-chart-bars__item-legend"> 
                            <div class="bu-my-4 bu-ml-6"> 
                                <div class="text-medium"> Failed <cly-tooltip-icon :tooltip="i18n('push-notification.description')" icon="ion ion-help-circled" class="bu-ml-1"> </cly-tooltip-icon> </div>
                                <div class="cly-vue-push-notification-details-chart-bars__item-legend-percentage"> {{findFailedPushNotifications()}} % </div>
                                <div class="text-medium"> {{totalAppUsers}} users </div>
                            </div>
                        </div>
                    </div>
                </div>
            </cly-section>
            <div class="cly-vue-push-notification-details-summary">
                <div class="bu-columns">
                    <div class="bu-column bu-is-10">
                        <cly-header title="Message Summary" class="cly-vue-push-notification-details-summary__header">
                            <template v-slot:header-left>
                                <h2> {{i18n('push-notification-details.summary-header')}} </h2>
                                <cly-tooltip-icon :tooltip="i18n('push-notification.description')" icon="ion ion-help-circled"> </cly-tooltip-icon>
                            </template>
                            <template v-slot:header-tabs>
                                <cly-dynamic-tabs v-model="currentSummaryTab" skin="secondary" :tabs="summaryTabs"></cly-dynamic-tabs>
                            </template>
                        </cly-header>
                    </div>
                    <div class="bu-column">
                        <mobile-message-preview :title="message.title" :content="message.content" :platforms="pushNotification.platforms" :media="previewMessageMedia" :buttons="message.buttons.map(function(item){return item.label})" class="cly-vue-push-notification-details-summary__message-preview"> </mobile-message-preview>
                    </div>
                </div>
            </div>
        </cly-main>
        <push-notification-drawer @onClose="onDrawerClose" :controls="drawers.pushNotificationDrawer" :type="pushNotification.type" :userCommand="userCommand.type" :id="userCommand.pushNotificationId" :isOpened="isDrawerOpen"></push-notification-drawer>
    </div>
</script>
